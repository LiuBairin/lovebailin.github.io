<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>blog</title>
    <script type="module" crossorigin="" src="/assets/app-6cb5fdbe.js"></script>
    <link rel="stylesheet" href="/assets/index-db5128d5.css">
  <link rel="modulepreload" crossorigin="" href="/assets/es9-9eed4f0c.js"><link rel="modulepreload" crossorigin="" href="/assets/BlTitle-e6ef2f67.js"></head>
  <body>
    <div id="app" data-server-rendered="true"><!--[--><!--[--><header h18="" px8="" py4="" flex="" justify-between="" fixed="" top-0="" left-0="" right-0="" bottom-0="" data-v-e1ae0180=""><div data-v-e1ae0180=""></div><div grid="" gap4="" grid-auto-flow-col="" text-5="" justify-items-center="" items-center="" data-v-e1ae0180=""><a href="/" c-op-70="" hover:c-op-100="" text-4="" class="!c-trueGray" data-v-e1ae0180="">Blog</a><a href="https://marketplace.visualstudio.com/search?term=BaiLin&amp;target=VSCode&amp;category=All%20categories&amp;sortBy=Relevance" c-op-70="" hover:c-op-100="" text-4="" class="!c-trueGray" i-akar-icons:vscode-fill="" data-v-e1ae0180=""></a><a href="https://github.com/lovebailin" i-ph:github-logo-bold="" c-op-70="" hover:c-op-100="" class="!c-trueGray" data-v-e1ae0180=""></a><div dark:i-ic:outline-light-mode="" i-ic:baseline-brightness-2="" cursor-pointer="" c-op-70="" hover:c-op-100="" c-truegray="" data-v-e1ae0180=""></div></div></header><header h18="" data-v-e1ae0180=""></header><!--]--><div class="write markdown-body"><!--[--><h1 class="!font900">ES2018(ES9)新特性</h1><p><!--[--><span style="color:#a7097f;" border="" border-current="" rounded="" border-style-solid="" px-1="" pb-0.2="" mb-0="" mr-2="">ecma</span><span style="color:#df1800;" border="" border-current="" rounded="" border-style-solid="" px-1="" pb-0.2="" mb-0="" mr-2="">js</span><!--]--></p><p class="!mb12">11/03/2023</p><!--]--><h2 id="es2018(es9)%E6%96%B0%E7%89%B9%E6%80%A7" tabindex="-1">ES2018(ES9)新特性</h2><h3 id="async%2Fawait-%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3" tabindex="-1">async/await 异步迭代</h3><p>ES8 为我们带来 <code class="">async/await</code>，使我们能在同步的写法中执行异步函数，但是在循环中：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>上面代码执行不符合预期，循环本身依旧保持同步，并在在内部异步函数之前全部调用完成。</p><p>ES2018 引入异步迭代器（asynchronous iterators），使得 <code class="">await</code> 可以和 <code class="">for...of</code> 循环一起使用，以串行的方式运行异步操作。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">of</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="promise.finally()" tabindex="-1">Promise.finally()</h3><p>ES6 为我们带来了 <code class="">Promise</code>，但是它的结果要么成功 <code class="">then</code> 要么失败 <code class="">catch</code>，使得我们的一些逻辑，如执行状态修改，结束回调都得在两边写一遍。</p><p>选择有了 <code class="">finally()</code>，逻辑只可以放在一个地方了，这有点像以前 <code class="">jQuery ajax</code> 的 <code class="">complete</code>。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// reslove</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// reject</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// complete</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><p><code class="">finally()</code>没有参数传入。</p><h3 id="rest%2Fspread-%E5%B1%9E%E6%80%A7" tabindex="-1">Rest/Spread 属性</h3><p>ES2015 引入了 Rest 参数和扩展运算符。当时三个点 <code class="">...</code> 仅用于数组。</p><p><code class="">Rest</code> 参数语法允许我们将一个剩余参数表示为一个数组。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">...</span>rest</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// a = 1</span>
  <span class="token comment">// b = 2</span>
  <span class="token comment">// rest = [3, 4, 5]</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre><p>展开操作符则是将数组转换成可传递给函数的单独参数。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 5</span>
</code></pre><p>现在对象也可以使用它们了。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// a = 1</span>
  <span class="token comment">// b = 2</span>
  <span class="token comment">// rest = { c: 3, d: 4, e: 5</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">e</span><span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  <span class="token literal-property property">e</span><span class="token operator">:</span> <span class="token number">5</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> object
<span class="token comment">// a = 1</span>
<span class="token comment">// b = 2</span>
<span class="token comment">// rest = { c: 3, d: 4, e: 5 }</span>
</code></pre><p>跟数组一样，Rest 参数只能在声明的结尾处使用。</p><h3 id="%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-s%EF%BC%88dotall-%E6%A8%A1%E5%BC%8F%EF%BC%89%E6%A0%87%E8%AE%B0" tabindex="-1">正则表达式 s（dotAll 模式）标记</h3><p>在正则中，<code class="">.</code> 可以匹配任意字符，除了换行符。</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello.es9</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'hello\nes9'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre><p>ES2018 引入了 dotAll 模式，通过使用标记<code class="">s</code>选项，<code class="">.</code>就可以匹配换行符。</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hello.es9</span><span class="token regex-delimiter">/</span><span class="token regex-flags">s</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'hello\nes9'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre><h3 id="%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F-unicode-%E8%BD%AC%E4%B9%89" tabindex="-1">正则表达式 Unicode 转义</h3><p>目前在正则中，可以通过字符集的名称来匹配字符。如<code class="">s</code>代表空白</p><pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre><p>在 ES2018 添加了 Unicode 属性转义，形式为<code class="">\p{...}</code>和<code class="">\P{...}</code>，在正则表达式中使用标记<code class="">u</code>(unicode) 选项。</p><pre class="language-javascript"><code class="language-javascript"><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\p{White_Space}+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>       <span class="token comment">// true 空格</span>
<span class="token operator">/</span><span class="token operator">^</span>\p<span class="token punctuation">{</span>Script<span class="token operator">=</span>Greek<span class="token punctuation">}</span><span class="token operator">+</span>$<span class="token operator">/</span>u<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'μετά'</span><span class="token punctuation">)</span>   <span class="token comment">// true 希腊字母</span>
<span class="token operator">/</span><span class="token operator">^</span>\p<span class="token punctuation">{</span>Script<span class="token operator">=</span>Latin<span class="token punctuation">}</span><span class="token operator">+</span>$<span class="token operator">/</span>u<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Grüße'</span><span class="token punctuation">)</span>  <span class="token comment">// true 匹配拉丁字母</span>
<span class="token operator">/</span><span class="token operator">^</span>\p<span class="token punctuation">{</span>Surrogate<span class="token punctuation">}</span><span class="token operator">+</span>$<span class="token operator">/</span>u<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'\u{D83D}'</span><span class="token punctuation">)</span>  <span class="token comment">// true 匹配单独的替代字符</span>
</code></pre><h3 id="lookbehind-%E5%8F%8D%E5%90%91%E6%96%AD%E8%A8%80" tabindex="-1">lookbehind 反向断言</h3><p>目前 JavaScript 在正则表达式中支持先行断言（lookahead）。这意味着匹配会发生，但是断言没有包含在整个匹配字段中。</p><p>如匹配字符串“10 hours”中紧跟着是”hours”的数字：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+(?= hours)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'10 hours'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 10</span>
</code></pre><p>匹配字符串“10 minutes”中紧跟着不是”hours”的数字：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+(?! hours)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'10 minutes'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 10</span>
</code></pre><p>ES2018 引入以相同方式工作但是匹配前面的反向断言（lookbehind）。</p><p>匹配字符串“hours10”中”hours”后面的数字：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;=hours)\d+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'hours10'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 10</span>
</code></pre><p>匹配字符串“minutes10”中数字前面不是“hours”：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;!hours)\d+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'minutes10'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 10</span>
</code></pre><h3 id="named-capture-groups-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%91%BD%E5%90%8D%E6%8D%95%E8%8E%B7%E7%BB%84" tabindex="-1">Named capture groups 正则表达式命名捕获组</h3><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d{4})-(\d{2})-(\d{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'2018-12-31'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// 2018-12-12</span>
matched<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// 2018</span>
matched<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">// 12</span>
matched<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// 31</span>
</code></pre><p>代码可读性较差，并且改变正则表达式的结构有可能改变匹配对象的索引。</p><p>ES2018 允许命名捕获组使用符号<code class="">?&lt;name&gt;</code>, 可以指定小括号中匹配内容的名称放在<code class="">groups</code>里，这样可以提高代码的可读性。</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token keyword">const</span> matched <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'2018-12-31'</span><span class="token punctuation">)</span>
matched<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>year <span class="token comment">// 2018</span>
matched<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>month <span class="token comment">// 12</span>
matched<span class="token punctuation">.</span>groups<span class="token punctuation">.</span>day <span class="token comment">// 31</span>
</code></pre><p>命名捕获组也可以使用在<code class="">replace()</code>方法中。例如将日期转换为“年月日”格式：</p><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})</span><span class="token regex-delimiter">/</span><span class="token regex-flags">u</span></span>
<span class="token string">'2018-12-31'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token string">'<div id="app"></div>lt;year&gt;年<div id="app"></div>lt;month&gt;月<div id="app"></div>lt;day&gt;日'</span><span class="token punctuation">)</span> <span class="token comment">// 2018年12月31日</span>
</code></pre><h3 id="%E9%9D%9E%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2" tabindex="-1">非转义序列的模板字符串</h3><p>ES2018 移除对 ECMAScript 在带标签的模版字符串中转义序列的语法限制。</p><p>之前，<code class="">\u</code> 开始一个 unicode 转义，<code class="">\x</code> 开始一个十六进制转义，<code class="">\</code>后跟一个数字开始一个八进制转义。这使得创建特定的字符串变得不可能，例如 Windows 文件路径 <code class="">C:\uuu\xxx\111</code>。</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals">模板字符串 - JavaScript | MDN (mozilla.org)</a></p></div><!--]--></div>
    
  

</body></html>